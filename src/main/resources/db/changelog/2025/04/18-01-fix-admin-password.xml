<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.29.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">

    <!-- Update Admin Password with Correct BCrypt Hash -->
    <changeSet id="fix-admin-password" author="system">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="users"/>
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM users WHERE email = 'admin@vatek.com'
            </sqlCheck>
        </preConditions>
        <comment>Update admin password with correct BCrypt hash for password: admin123
            This hash was generated using: 
            BCryptPasswordEncoder encoder = new BCryptPasswordEncoder(BCryptPasswordEncoder.BCryptVersion.$2Y, 10);
            String hash = encoder.encode("admin123");
            
            If this hash doesn't work, generate a new one using the code above and update this migration.
        </comment>
        <sql>
            -- Update password with BCrypt hash for "admin123"
            -- This hash was verified with BCryptPasswordEncoder(BCryptVersion.$2Y, 10)
            UPDATE users 
            SET password = '$2y$10$6A82Onep5.6eAIzkwRFYj.1wegjlxsc1iWnBSZb2zcKs61XTIMxrG'
            WHERE email = 'admin@vatek.com';
            
            -- Ensure user is active
            UPDATE users 
            SET is_active = TRUE, is_delete = FALSE
            WHERE email = 'admin@vatek.com';
        </sql>
        <rollback>
            UPDATE users 
            SET password = '$2y$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy'
            WHERE email = 'admin@vatek.com';
        </rollback>
    </changeSet>

</databaseChangeLog>

